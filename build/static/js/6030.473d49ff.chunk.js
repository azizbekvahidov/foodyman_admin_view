"use strict";(self.webpackChunkgithubit_dashboard=self.webpackChunkgithubit_dashboard||[]).push([[6030],{89802:function(e,n,t){t.d(n,{q:function(){return c}});var i=t(1413),r=t(29439),l=t(45987),a=t(47313),d=t(74294),o=t(72652),s=t(46417),u=["fetchOptions","refetch"],c=function(e){var n=e.fetchOptions,t=e.refetch,c=void 0!==t&&t,v=(0,l.Z)(e,u),p=(0,a.useState)(!1),f=(0,r.Z)(p,2),h=f[0],m=f[1],y=(0,a.useState)([]),x=(0,r.Z)(y,2),Z=x[0],j=x[1];return(0,s.jsx)(d.Z,(0,i.Z)((0,i.Z)({labelInValue:!0,filterOption:!1,notFoundContent:h?(0,s.jsx)(o.Z,{size:"small"}):"no results"},v),{},{options:h?[]:Z,onFocus:function(){Z.length&&!c||(m(!0),n().then((function(e){j(e),m(!1)})))}}))}},16030:function(e,n,t){t.r(n),t.d(n,{default:function(){return ke}});var i=t(1413),r=t(29439),l=t(47313),a=t(18197),d=t(256),o=t(59491),s=t(68197),u=t(59624),c=t(72652),v=t(74165),p=t(15861),f=t(77181),h=t(74294),m=t(66672),y=t(16031),x=t(49986),Z=t(89281),j=t(2717),g=t(73270),_=t(24511),b=t(55768),k=t(90954),w=t(58467),q=t(34491),N=t(89802),S=t(20637),C=t(84695),I=t(97388),M=t(17649),D=t(47168),U=t(97421),Y=t(46417);function H(e){var n,t,d=e.uuid,s=e.handleCancel,u=(0,_.$)().t,c=a.Z.useForm(),v=(0,r.Z)(c,1)[0],p=(0,j.I0)(),f=(0,j.v9)((function(e){return e.menu}),j.wU).activeMenu,h=(0,j.v9)((function(e){return e.globalSettings}),j.wU).settings,m=(0,j.v9)((function(e){return e.globalSettings.settings}),j.wU).google_map_key,y=(0,j.v9)((function(e){return e.order}),j.wU).data,x=(0,D.usePlacesWidget)({apiKey:m||U.kr,onPlaceSelected:function(e){var n={lat:null===e||void 0===e?void 0:e.geometry.location.lat(),lng:null===e||void 0===e?void 0:e.geometry.location.lng()};N(n)}}),Z=x.ref,b=(0,l.useState)(y.address?{lat:y.address.lat,lng:y.address.lng}:(0,M.Z)(h)),w=(0,r.Z)(b,2),q=w[0],N=w[1];return(0,Y.jsx)(C.Z,{visible:!!d,title:u("create.address"),onCancel:s,footer:[(0,Y.jsx)(o.Z,{type:"primary",onClick:function(){return v.submit()},children:u("save")},"saveBtn"),(0,Y.jsx)(o.Z,{type:"default",onClick:s,children:u("cancel")},"cancelBtn")],children:(0,Y.jsxs)(a.Z,{layout:"vertical",name:"user-address",form:v,onFinish:function(e){var n=(0,i.Z)((0,i.Z)({},e),{},{active:1,lat:q.lat,lng:q.lng});p((0,g.oM)({address:n})),p((0,k.nc)({activeMenu:f,data:(0,i.Z)((0,i.Z)({},f.data),{},{addressData:n})})),s()},initialValues:{address:null===f||void 0===f||null===(n=f.data)||void 0===n||null===(t=n.addressData)||void 0===t?void 0:t.address},children:[(0,Y.jsx)(a.Z.Item,{name:"address",label:u("address"),rules:[{required:!0,message:u("required")}],children:(0,Y.jsx)("input",{className:"address-input",ref:Z,placeholder:""})}),(0,Y.jsx)(a.Z.Item,{label:u("map"),children:(0,Y.jsx)(I.Z,{location:q,setLocation:N,setAddress:function(e){return v.setFieldsValue({address:e})}})})]})})}var F=function(e){var n,t,i=e.form,d=(0,_.$)().t,c=(0,j.I0)(),C=(0,w.s0)(),I=(0,j.v9)((function(e){return e.order}),j.wU).data,M=(0,j.v9)((function(e){return e.currency}),j.wU).currencies,D=(0,j.v9)((function(e){return e.menu}),j.wU).activeMenu,U=(0,l.useState)(null),F=(0,r.Z)(U,2),O=F[0],A=F[1],B=(0,l.useState)([]),E=(0,r.Z)(B,2),P=E[0],V=E[1],$=(0,l.useState)(!1),z=(0,r.Z)($,2),L=z[0],W=z[1],J=(0,j.v9)((function(e){return e.globalSettings.settings}),j.wU).payment_type;function Q(){return Q=(0,p.Z)((0,v.Z)().mark((function e(n){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={search:n,perPage:10},e.abrupt("return",x.Z.search(t).then((function(e){var n=e.data;return V(n),X(n)})));case 2:case"end":return e.stop()}}),e)}))),Q.apply(this,arguments)}function T(){return(T=(0,p.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.Z.getAll().then((function(e){return e.data.filter((function(e){return"cash"===e.tag||"wallet"===e.tag})).map((function(e){return{label:e.tag||"no name",value:e.id,key:e.id}}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=(0,p.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.Z.getById(I.shop.value).then((function(e){return e.data.filter((function(e){return"cash"===e.tag||"wallet"===e.tag})).map((function(e){return{label:e.payment.tag||"no name",value:e.payment.id,key:e.payment.id}}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){if(e)return(0,y.isArray)(e)?e.map((function(e){return{label:"".concat(e.firstname," ").concat(e.lastname||""),value:e.id}})):{label:"".concat(e.firstname," ").concat(e.lastname||""),value:e.id,key:e.id}}(0,l.useEffect)((function(){W(!0)}),[I.shop]);return(0,Y.jsxs)(f.Z,{title:d("customer.details"),children:[(0,Y.jsxs)(s.Z,{gutter:12,children:[(0,Y.jsx)(u.Z,{span:16,children:(0,Y.jsx)(a.Z.Item,{label:d("client"),name:"user",rules:[{required:!0,message:d("required")}],children:(0,Y.jsx)(Z.h,{placeholder:d("select.client"),fetchOptions:function(e){return Q.apply(this,arguments)},onSelect:function(e){var n=P.find((function(n){return n.id===e.value}));c((0,g.oM)({user:e,userUuid:n.uuid,userOBJ:n})),i.setFieldsValue({address:null})}})})}),(0,Y.jsx)(u.Z,{span:8,children:(0,Y.jsx)(a.Z.Item,{label:d("add"),className:"label-hidden",children:(0,Y.jsx)(o.Z,{icon:(0,Y.jsx)(b.Z,{}),onClick:function(){c((0,k.bL)({url:"user/add",id:"user_add",name:d("add.user")})),C("/user/add")},children:d("add")})})}),(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsx)(a.Z.Item,{label:d("address"),name:"address",rules:[{required:!1,message:d("required")}],children:(0,Y.jsx)("div",{className:"address w-100",onClick:function(){I.userUuid?A(I.userUuid):q.Am.warning(d("please.select.client"))},children:null===(n=D.data)||void 0===n||null===(t=n.addressData)||void 0===t?void 0:t.address})})}),(0,Y.jsx)(u.Z,{span:12,children:(0,Y.jsx)(a.Z.Item,{label:d("currency"),name:"currency_id",rules:[{required:!0,message:d("required")}],children:(0,Y.jsx)(h.Z,{placeholder:d("select.currency"),onSelect:function(e){var n=M.find((function(n){return n.id===e}));c((0,g.dY)(n))},children:M.map((function(e,n){return(0,Y.jsxs)(h.Z.Option,{value:e.id,children:[e.title," (",e.symbol,")"]},n)}))})})}),(0,Y.jsx)(u.Z,{span:12,children:(0,Y.jsx)(a.Z.Item,{label:d("payment.type"),name:"payment_type",rules:[{required:!0,message:d("required")}],children:(0,Y.jsx)(N.q,{refetch:L,fetchOptions:"admin"===J?function(){return T.apply(this,arguments)}:function(){return K.apply(this,arguments)},className:"w-100",placeholder:d("select.payment.type"),onSelect:function(e){return c((0,g.oM)({paymentType:e}))}})})}),(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsx)(a.Z.Item,{label:d("note"),name:"note",children:(0,Y.jsx)(m.Z,{})})})]}),O&&(0,Y.jsx)(H,{uuid:O,handleCancel:function(){return A(null)}})]})},O=t(99096),A=t(70816),B=t.n(A),E=t(53149),P=[{title:"sunday"},{title:"monday"},{title:"tuesday"},{title:"wednesday"},{title:"thursday"},{title:"friday"},{title:"saturday"}],V=function(){var e,n,t,r,d,o,c,v=(0,_.$)().t,p=(0,j.I0)(),m=(0,j.v9)((function(e){return e.order}),j.wU).data,y=(0,j.v9)((function(e){return e.menu}),j.wU).activeMenu,x=new Date(null===m||void 0===m?void 0:m.delivery_date),Z=null===(e=y.data)||void 0===e||null===(n=e.CurrentShop)||void 0===n||null===(t=n.shop_working_days)||void 0===t?void 0:t.filter((function(e){return!0!==e.disabled})).find((function(e){var n;return(null===e||void 0===e?void 0:e.day)===(null===(n=P[x.getDay()])||void 0===n?void 0:n.title)})),b=null===(r=y.data)||void 0===r||null===(d=r.CurrentShop)||void 0===d||null===(o=d.shop_closed_date)||void 0===o?void 0:o.map((function(e){return e.day}));var w=function(e,n){for(var t=[],i=e;i<n;i++)t.push(i);return t},q=[{label:"delivery",value:(null===(c=m.shop)||void 0===c?void 0:c.price)||0,key:1},{label:"pickup",value:"0",key:2}];return(0,l.useEffect)((function(){var e,n,t;null!==m&&void 0!==m&&null!==(e=m.shop)&&void 0!==e&&e.value&&(t=null===m||void 0===m||null===(n=m.shop)||void 0===n?void 0:n.value,E.Z.getById(t).then((function(e){var n=null===e||void 0===e?void 0:e.data;p((0,g.oM)({currency_shop:n})),p((0,k.nc)({activeMenu:y,data:(0,i.Z)((0,i.Z)({},null===y||void 0===y?void 0:y.data),{},{CurrentShop:null===e||void 0===e?void 0:e.data})}))})))}),[null===m||void 0===m?void 0:m.shop]),(0,Y.jsx)(f.Z,{title:v("shipping.info"),children:(0,Y.jsxs)(s.Z,{gutter:12,children:[(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsx)(a.Z.Item,{name:"delivery",label:v("delivery"),rules:[{required:!0,message:v("required")}],children:(0,Y.jsx)(h.Z,{options:q,labelInValue:!0,onSelect:function(e){return p((0,g.oM)({delivery_fee:null===e||void 0===e?void 0:e.value}))},onChange:function(e){return p((0,g.oM)({deliveries:e}))}})})}),(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsxs)(s.Z,{gutter:12,children:[(0,Y.jsx)(u.Z,{span:12,children:(0,Y.jsx)(a.Z.Item,{name:"delivery_date",label:v("delivery.date"),rules:[{required:!0,message:v("required")}],children:(0,Y.jsx)(O.Z,{placeholder:v("delivery.date"),className:"w-100",format:"YYYY-MM-DD",disabledDate:function(e){var n=null===b||void 0===b?void 0:b.find((function(n){return n===B()(e).format("YYYY-MM-DD")})),t=B()().add(-1,"days")>=e;return n||t},onChange:function(e){var n=B()(e).format("YYYY-MM-DD");p((0,g.oM)({delivery_date:n}))}})})}),(0,Y.jsx)(u.Z,{span:12,children:(0,Y.jsx)(a.Z.Item,{label:"".concat(v("delivery.time")," (").concat(v("up.to"),")"),name:"delivery_time",rules:[{required:!1,message:v("required")}],children:(0,Y.jsx)(O.Z,{disabled:!(null!==m&&void 0!==m&&m.delivery_date),picker:"time",placeholder:v("start.time"),className:"w-100",format:"HH:mm:ss",showNow:!1,disabledTime:function(){return{disabledHours:function(){return function(e,n){for(var t=parseInt(e),i=parseInt(n),r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],l=t;l<=i;l++)delete r[l];return r}((null===Z||void 0===Z?void 0:Z.from.substring(0,2))>=B()(new Date).format("HH")?null===Z||void 0===Z?void 0:Z.from.substring(0,2):B()(new Date).format("HH"),null===Z||void 0===Z?void 0:Z.to.substring(0,2))},disabledMinutes:function(){return w(0,60)},disabledSeconds:function(){return w(0,60)}}},onChange:function(e){var n=B()(e).format("HH:mm:ss");p((0,g.oM)({delivery_time:n}))}})})})]})})]})})},$=t(45705),z=t(11216),L=t(30763),W=t(11875),J=t(45464),Q=t(82138),T=t(11829),K=t(12019),X=t(8846),G=t(43681),R=t(7370),ee=t(93433),ne=t(78891),te=t(83371),ie=t(32697),re=t(84017),le=t(91220),ae=t(77370),de=t(28939),oe=t(80314),se=t(17101);function ue(e){var n,t,a,d,v,p=e.extrasModal,f=e.setExtrasModal,h=(0,l.useState)(!1),m=(0,r.Z)(h,2),y=m[0],x=m[1],Z=(0,l.useState)({}),b=(0,r.Z)(Z,2),k=b[0],w=b[1],N=(0,_.$)().t,S=(0,l.useState)(p.quantity||k.quantity||k.min_qty),I=(0,r.Z)(S,2),M=I[0],D=I[1],U=(0,l.useState)({}),H=(0,r.Z)(U,2),F=H[0],O=H[1],A=(0,j.v9)((function(e){return e.order.data}),j.wU).currency,B=(0,j.I0)(),E=(0,l.useState)([]),P=(0,r.Z)(E,2),V=P[0],z=P[1],L=(0,l.useState)([]),W=(0,r.Z)(L,2),T=W[0],K=W[1],G=(0,l.useState)({extras:[],stock:{id:0,quantity:1,price:0}}),R=(0,r.Z)(G,2),ue=R[0],ce=R[1],ve=(0,l.useState)([]),pe=(0,r.Z)(ve,2),fe=pe[0],he=pe[1],me=(0,l.useState)([]),ye=(0,r.Z)(me,2),xe=ye[0],Ze=ye[1],je=(0,l.useState)([]),ge=(0,r.Z)(je,2),_e=ge[0],be=ge[1],ke=function(){return f(!1)};var we=function(e){var n,t=fe.findIndex((function(n){return n.extra_group_id===e.extra_group_id})),i=fe;t>-1&&(i=i.slice(0,t)),i.push(e);var r=i.map((function(e){return e.id})).join(","),l=(0,ae.y)(r,V,T);ce(l),null===(n=l.extras)||void 0===n||n.forEach((function(n){var t=fe.findIndex((function(t){return n[0].extra_group_id!=e.extra_group_id?t.extra_group_id===n[0].extra_group_id:t.extra_group_id===e.extra_group_id}));if(n[0].level>=e.level){var r=n[0].extra_group_id!=e.extra_group_id?n[0]:e;-1==t?i.push(r):i[t]=r}})),he(i)};(0,l.useEffect)((function(){null!==ue&&void 0!==ue&&ue.stock&&O((0,i.Z)((0,i.Z)({},ue.stock),{},{extras:fe}))}),[ue]);function qe(e){return(null===xe||void 0===xe?void 0:xe.reduce((function(e,n){return e+n.product.stock.price*(n.product.quantity||n.product.min_qty)}),0))+ue.stock[e||"price"]*M}function Ne(e,n){ce((function(t){return(0,i.Z)((0,i.Z)({},t),{},{stock:(0,i.Z)((0,i.Z)({},t.stock),{},{addons:t.stock.addons.map((function(t){return t.addon_id===e?(0,i.Z)((0,i.Z)({},t),{},{product:(0,i.Z)((0,i.Z)({},t.product),{},{quantity:n})}):t}))})})})),Ze((function(t){return t.map((function(t){return t.addon_id===e?(0,i.Z)((0,i.Z)({},t),{},{product:(0,i.Z)((0,i.Z)({},t.product),{},{quantity:n})}):t}))}))}return(0,oe.Z)((function(){var e=ue.stock.addons.filter((function(e){return _e.includes(String(e.addon_id))}));Ze(e)}),[_e]),(0,l.useEffect)((function(){x(!0),se.Z.getById(p.uuid).then((function(e){var n,t=e.data;w(t);var i,r=(0,ae.o)(t,null===p||void 0===p?void 0:p.addons);(console.log(p),console.log(r),z(r.extras),D(p.quantity||t.quantity||t.min_qty),K(r.stock),ce((0,ae.y)("",r.extras,r.stock)),null===(n=(0,ae.y)("",r.extras,r.stock).extras)||void 0===n||n.forEach((function(e){he((function(n){return[].concat((0,ee.Z)(n),[e[0]])}))})),null!==p&&void 0!==p&&p.addons)&&be((null===p||void 0===p||null===(i=p.addons)||void 0===i?void 0:i.map((function(e){var n,t;return String((null===e||void 0===e||null===(n=e.stock)||void 0===n||null===(t=n.product)||void 0===t?void 0:t.id)||e.addon_id)})))||[])})).finally((function(){return x(!1)}))}),[p.uuid]),(0,Y.jsx)(C.Z,{visible:!!k,title:null===k||void 0===k||null===(n=k.translation)||void 0===n?void 0:n.title,onCancel:ke,footer:[(0,Y.jsx)(o.Z,{type:"primary",onClick:function(){B((0,g.oM)({calculate:!1}));var e=xe.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{quantity:e.product.quantity||e.product.min_qty,stock_id:e.product.stock.id})})),n=(0,i.Z)((0,i.Z)({},k),{},{stock:F,quantity:M,id:F.id,img:(0,de.Z)(F)||k.img,stockID:F,addons:e,price:F.price});n.quantity>F.quantity?q.Am.warning("".concat(N("you.cannot.order.more.than")," ").concat(F.quantity)):(B((0,g.x$)(n)),f(null))},children:N("add")},"add-product"),(0,Y.jsx)(o.Z,{type:"default",onClick:ke,children:N("cancel")},"cancel-modal")],children:(0,Y.jsxs)(c.Z,{spinning:y,children:[(0,Y.jsxs)(s.Z,{gutter:24,children:[(0,Y.jsx)(u.Z,{span:8,children:(0,Y.jsx)(ne.Z,{src:(0,J.Z)((0,de.Z)(F)||k.img),alt:k.name,height:200,style:{objectFit:"contain"}})}),(0,Y.jsx)(u.Z,{span:16,children:(0,Y.jsxs)(te.Z,{title:null===(t=k.translation)||void 0===t?void 0:t.title,children:[(0,Y.jsxs)(te.Z.Item,{label:N("price"),span:3,children:[(0,Y.jsx)("div",{className:null!==F&&void 0!==F&&F.discount?"strike":"",children:(0,re.Z)(qe(),A.symbol)}),null!==F&&void 0!==F&&F.discount?(0,Y.jsx)("div",{className:"ml-2 font-weight-bold",children:(0,re.Z)(qe("total_price"),A.symbol)}):""]}),(0,Y.jsx)(te.Z.Item,{label:N("in.stock"),span:3,children:(0,le.Z)(null===F||void 0===F?void 0:F.quantity,k.unit)}),(0,Y.jsx)(te.Z.Item,{label:N("tax"),span:3,children:(0,re.Z)(null===F||void 0===F?void 0:F.tax,A.symbol)})]})})]}),null===ue||void 0===ue||null===(a=ue.extras)||void 0===a?void 0:a.map((function(e,n){return(0,Y.jsx)("div",{className:"extra-group",children:(0,Y.jsx)($.Z,{className:"extras-select",children:e.map((function(e){return"color"===e.group.type?(0,Y.jsx)("span",{className:"extras-color-wrapper ".concat(fe.find((function(n){return n.id===e.id}))?"selected":""),onClick:function(){return we(e)},children:(0,Y.jsx)("i",{className:"extras-color",style:{backgroundColor:e.value}})}):"text"===e.group.type?(0,Y.jsx)("span",{className:"extras-text rounded ".concat(fe.find((function(n){return n.id===e.id}))?"selected":""),onClick:function(){return we(e)},children:e.value}):(0,Y.jsx)("span",{className:"extras-image rounded ".concat(fe.find((function(n){return n.id===e.id}))?"selected":""),onClick:function(){return we(e)},children:(0,Y.jsx)("img",{src:(0,J.Z)(e.value),alt:"extra"})})}))},"extra-group"+n)})})),(0,Y.jsx)($.Z,{direction:"vertical",size:"middle",children:null===(d=ue.stock)||void 0===d||null===(v=d.addons)||void 0===v?void 0:v.filter((function(e){return!!e.product})).map((function(e){var n=_e.includes(String(e.addon_id));return(0,Y.jsxs)("div",{children:[(0,Y.jsx)(ie.Z,{id:String(e.id),name:String(e.id),checked:n,onChange:function(){return function(e){var n=String(e.addon_id);_e.includes(n)?be((function(e){return e.filter((function(e){return e!==n}))})):be((function(e){return[].concat((0,ee.Z)(e),[n])}))}(e)}}),(0,Y.jsxs)("label",{htmlFor:String(e.id),children:[n&&(0,Y.jsxs)($.Z,{size:0,children:[(0,Y.jsx)(o.Z,{type:"text",className:"minus-button",style:{padding:0,height:"max-content"},size:"small",icon:(0,Y.jsx)(X.Z,{}),disabled:1===e.product.quantity,onClick:function(n){n.stopPropagation(),Ne(e.addon_id,e.product.quantity-1)}}),(0,Y.jsx)("span",{className:"ml-2",children:e.product.quantity||e.product.min_qty}),(0,Y.jsx)(o.Z,{type:"text",className:"plus-button",style:{padding:0,height:"max-content"},size:"small",icon:(0,Y.jsx)(Q.Z,{}),onClick:function(n){n.stopPropagation(),Ne(e.addon_id,e.product.quantity?e.product.quantity+1:e.product.min_qty+1)}})]}),(0,Y.jsx)("span",{className:"ml-2",children:e.product.translation.title})]})]},e.id)}))}),(0,Y.jsx)(s.Z,{gutter:12,className:"mt-3",children:(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)(o.Z,{type:"primary",icon:(0,Y.jsx)(X.Z,{}),onClick:function(){1!==M&&(M<=k.min_qty||D((function(e){return e-1})))}},"plus"),M,(0,Y.jsx)(o.Z,{type:"primary",icon:(0,Y.jsx)(Q.Z,{}),onClick:function(){M!==k.max_qty&&D((function(e){return e+1}))}},"minus")]})})})]})})}var ce=t(95882),ve=t(21448),pe=t(74776),fe=t.n(pe),he=t(58821);function me(){var e,n,t,a,d,v,p,h,y,x=(0,_.$)().t,Z=(0,j.I0)(),b=(0,w.s0)(),q=(0,j.v9)((function(e){return e.order}),j.wU),N=q.orderItems,S=q.data,C=q.total,I=q.coupon,M=q.orderProducts,D=(0,l.useState)(!1),U=(0,r.Z)(D,2),H=U[0],F=U[1],O=(0,l.useState)(null),A=(0,r.Z)(O,2),B=A[0],P=A[1],V=(0,l.useState)(!1),z=(0,r.Z)(V,2),L=z[0],ee=z[1],ne=(0,j.v9)((function(e){return e.menu}),j.wU).activeMenu;(0,oe.Z)((function(){var e,n,t;(Z((0,ce.q1)({perPage:12,currency_id:S.currency.id,shop_id:null===(e=S.shop)||void 0===e?void 0:e.value})),null!==S&&void 0!==S&&null!==(n=S.shop)&&void 0!==n&&n.value)&&le(null===S||void 0===S||null===(t=S.shop)||void 0===t?void 0:t.value)}),[S.currency,S.shop]),(0,oe.Z)((function(){N.length?function(){var e;if(null!==S&&void 0!==S&&null!==(e=S.deliveries)&&void 0!==e&&e.label){var n=function(e){var n,t,i,r,l,a,d,o=null===e||void 0===e?void 0:e.map((function(e){var n,t;return{quantity:e.quantity,stock_id:e.stockID?null===(n=e.stockID)||void 0===n?void 0:n.id:null===(t=e.stock)||void 0===t?void 0:t.id}})),s=null===e||void 0===e?void 0:e.flatMap((function(e){var n;return null===(n=e.addons)||void 0===n?void 0:n.map((function(n,t){var i,r;return{quantity:n.quantity,stock_id:n.stock_id,parent_id:e.stockID?null===(i=e.stockID)||void 0===i?void 0:i.id:null===(r=e.stock)||void 0===r?void 0:r.id}}))})),u={products:o.concat(s),currency_id:null===S||void 0===S||null===(n=S.currency)||void 0===n?void 0:n.id,coupon:null===S||void 0===S||null===(t=S.coupon)||void 0===t?void 0:t.name,shop_id:null===S||void 0===S||null===(i=S.shop)||void 0===i?void 0:i.value,type:null===S||void 0===S||null===(r=S.deliveries)||void 0===r||null===(l=r.label)||void 0===l?void 0:l.toLowerCase(),address:{latitude:null===S||void 0===S||null===(a=S.address)||void 0===a?void 0:a.lat,longitude:null===S||void 0===S||null===(d=S.address)||void 0===d?void 0:d.lng}};return fe().stringify(u,{addQueryPrefix:!0})}(N);F(!0),R.Z.calculate(n).then((function(e){var n=e.data.data,t={product_tax:n.total_tax,shop_tax:n.total_shop_tax,order_total:n.total_price,delivery_fee:n.delivery_fee};Z((0,g.rU)(t))})).catch((function(){return Z((0,g.r3)(M))})).finally((function(){return F(!1)}))}}():Z((0,g.pX)())}),[N,S.currency,S.address]);var te=function(e){Z((0,k.bL)({id:"product-".concat(e.uuid),url:"product/".concat(e.uuid),name:x("edit.product")})),b("/product/".concat(e.uuid))};var ie=function(e,n){Z((0,g.OQ)({quantity:e,id:n}))},le=function(e){E.Z.getById(e).then((function(e){Z((0,k.nc)({activeMenu:ne,data:(0,i.Z)((0,i.Z)({},ne.data),{},{shop:e.data})}))}))};return(0,Y.jsxs)("div",{className:"order-items",children:[H&&(0,Y.jsx)("div",{className:"loader",children:(0,Y.jsx)(c.Z,{})}),(0,Y.jsx)(s.Z,{gutter:24,className:"mt-4",children:(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsxs)(f.Z,{className:"shop-card",children:[null===N||void 0===N?void 0:N.map((function(e,n){var t,i,r,l,a,d;return void 0===e.bonus||!1===e.bonus?(0,Y.jsx)("div",{children:(0,Y.jsxs)(f.Z,{className:"position-relative",children:[(0,Y.jsx)(T.Z,{className:"close-order",onClick:function(){return Z((0,g.Sg)(e))}}),(0,Y.jsxs)($.Z,{className:"mr-3",children:[(0,Y.jsx)("div",{className:"order-item-img",children:(0,Y.jsx)("img",{src:(0,J.Z)(null===e||void 0===e?void 0:e.img),alt:null===(t=e.translation)||void 0===t?void 0:t.title})}),(0,Y.jsx)(W.Z,{title:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)("div",{className:"cursor-pointer white-space-wrap",onClick:function(){return te(e)},children:null===(i=e.translation)||void 0===i?void 0:i.title}),(0,Y.jsx)(o.Z,{icon:(0,Y.jsx)(K.Z,{}),type:"text",size:"small",onClick:function(){return P(e)}})]}),(0,Y.jsx)("div",{className:"product-price",children:(0,re.Z)(e.price,S.currency.symbol)})]}),description:(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)(o.Z,{disabled:e.quantity<e.min_qty+1,onClick:function(){return ie(e.quantity-1,e.id)},type:"primary",icon:(0,Y.jsx)(X.Z,{})})," ",e.quantity," ",(0,Y.jsx)(o.Z,{onClick:function(){return ie(e.quantity+1,e.id)},type:"primary",icon:(0,Y.jsx)(Q.Z,{})})]}),(0,Y.jsx)("div",{className:"mt-2",children:(0,Y.jsx)($.Z,{wrap:!0,children:null===e||void 0===e||null===(r=e.addons)||void 0===r?void 0:r.map((function(e){var n,t,i,r;return(0,Y.jsxs)("span",{className:"extras-text rounded",children:[(null===e||void 0===e||null===(n=e.stock)||void 0===n||null===(t=n.product)||void 0===t||null===(i=t.translation)||void 0===i?void 0:i.title)||(null===e||void 0===e||null===(r=e.product.translation)||void 0===r?void 0:r.title)," ","x ",null===e||void 0===e?void 0:e.quantity]},e.id)}))})})]})})]})]})}):(0,Y.jsx)("div",{children:(0,Y.jsx)("div",{children:(0,Y.jsx)(f.Z,{className:"position-relative",children:(0,Y.jsxs)($.Z,{className:"mr-3 w-100 justify-content-between align-items-start",children:[(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)("div",{className:"order-item-img",children:(0,Y.jsx)("img",{src:(0,J.Z)(null===e||void 0===e?void 0:e.img),alt:null===(l=e.translation)||void 0===l?void 0:l.title})}),(0,Y.jsx)(W.Z,{title:(0,Y.jsxs)("div",{children:[(0,Y.jsx)("div",{className:"cursor-pointer white-space-wrap",onClick:function(){return te(e)},children:null===(a=e.translation)||void 0===a?void 0:a.title}),(0,Y.jsx)("div",{className:"product-price",children:(0,re.Z)(e.price,null===(d=S.currency)||void 0===d?void 0:d.symbol)})]})})]}),(0,Y.jsxs)("div",{className:"bonus",children:[(0,Y.jsx)(he.ojn,{})," Bonus"]})]})})})},n)})),(0,Y.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)("img",{src:(0,J.Z)(null===(e=ne.data)||void 0===e||null===(n=e.shop)||void 0===n?void 0:n.logo_img),alt:"logo",width:40,height:40,className:"rounded-circle"}),(0,Y.jsx)("div",{children:null===(t=ne.data)||void 0===t||null===(a=t.shop)||void 0===a||null===(d=a.translation)||void 0===d?void 0:d.title})]}),(0,Y.jsxs)($.Z,{children:[(0,Y.jsx)(m.Z,{placeholder:x("coupon"),addonAfter:I.verified?(0,Y.jsx)(G.Z,{style:{color:"#18a695"}}):null,defaultValue:I.coupon,onBlur:function(e){var n;return Z((0,g.cp)({coupon:e.target.value,user_id:null===(n=S.user)||void 0===n?void 0:n.value,shop_id:S.shop.value,verified:!1}))}}),(0,Y.jsx)(o.Z,{onClick:function(){return S.shop.id,void(I&&(ee(!0),ve.Z.checkCoupon(I).then((function(e){var n=e.data;Z((0,g.oM)({coupon:n})),Z((0,g.NS)({price:e.data.price,verified:!0}))})).catch((function(){return Z((0,g.NS)({price:0,verified:!1}))})).finally((function(){return ee(!1)}))))},loading:L,children:x("check.coupon")})]}),(0,Y.jsxs)("div",{className:"mt-2 text-right shop-total",children:[(0,Y.jsxs)($.Z,{children:[(0,Y.jsxs)("p",{className:"font-weight-bold",children:[x("product.tax"),":"]}),(0,Y.jsx)("p",{children:(0,re.Z)(C.product_tax,null===(v=S.currency)||void 0===v?void 0:v.symbol)})]}),(0,Y.jsx)("div",{}),(0,Y.jsxs)($.Z,{children:[(0,Y.jsxs)("p",{className:"font-weight-bold",children:[x("shop.tax"),":"]}),(0,Y.jsx)("p",{children:(0,re.Z)(C.shop_tax,null===(p=S.currency)||void 0===p?void 0:p.symbol)})]}),(0,Y.jsx)("div",{}),(0,Y.jsxs)($.Z,{children:[(0,Y.jsxs)("p",{className:"font-weight-bold",children:[x("delivery.fee"),":"]}),(0,Y.jsx)("p",{children:(0,re.Z)(C.delivery_fee,null===(h=S.currency)||void 0===h?void 0:h.symbol)})]}),(0,Y.jsx)("div",{}),(0,Y.jsxs)($.Z,{children:[(0,Y.jsxs)("p",{className:"font-weight-bold",children:[x("total"),":"]}),(0,Y.jsx)("p",{children:(0,re.Z)(C.order_total,null===(y=S.currency)||void 0===y?void 0:y.symbol)})]})]})]})]})})}),B&&(0,Y.jsx)(ue,{extrasModal:B,setExtrasModal:P})]})}var ye=t(41481),xe=t(49067),Ze=t(51988),je=function(e){var n=e.form,t=(0,_.$)().t,i=(0,l.useState)(null),a=(0,r.Z)(i,2),d=a[0],o=a[1],h=(0,l.useState)(null),m=(0,r.Z)(h,2),y=m[0],x=m[1],b=(0,l.useState)(null),k=(0,r.Z)(b,2),N=k[0],S=k[1],C=(0,l.useState)(null),I=(0,r.Z)(C,2),M=I[0],D=I[1],U=(0,w.UO)().id,H=(0,j.I0)(),F=(0,j.v9)((function(e){return e.order}),j.wU).data,O=(0,j.v9)((function(e){return e.product}),j.wU),A=O.products,B=O.loading;function E(){return E=(0,p.Z)((0,v.Z)().mark((function e(n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z.Z.search(n).then((function(e){return e.data.map((function(e){return{label:e.title,value:e.id}}))})));case 1:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function P(){return P=(0,p.Z)((0,v.Z)().mark((function e(n){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={search:n,type:"main"},e.abrupt("return",L.Z.search(t).then((function(e){return e.data.map((function(e){var n;return{label:null===(n=e.translation)||void 0===n?void 0:n.title,value:e.id}}))})));case 2:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}(0,oe.Z)((function(){var e,n={perPage:10,page:1,brand_id:null===d||void 0===d?void 0:d.value,category_id:null===y||void 0===y?void 0:y.value,search:N,shop_id:null===(e=F.shop)||void 0===e?void 0:e.value,active:1};H((0,ce.q1)(n))}),[d,y,N,F.shop]);function V(){return V=(0,p.Z)((0,v.Z)().mark((function e(n){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={search:n,status:"approved"},e.abrupt("return",xe.Z.getAll(t).then((function(e){return e.data.map((function(e){var n;return{label:null===(n=e.translation)||void 0===n?void 0:n.title,value:e.id}}))})));case 2:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}return(0,Y.jsxs)(f.Z,{title:t("order.details"),extra:(0,Y.jsxs)($.Z,{wrap:!0,children:[(0,Y.jsx)(Z.h,{placeholder:t("select.shop"),fetchOptions:function(e){return V.apply(this,arguments)},style:{minWidth:150},onChange:function(e){H((0,g.HL)(e)),H((0,g.mf)()),n.setFieldsValue({delivery:null,delivery_date:null,delivery_time:null})},allowClear:!1,value:null===F||void 0===F?void 0:F.shop,disabled:U}),(0,Y.jsx)(Z.h,{placeholder:t("select.category"),fetchOptions:function(e){return P.apply(this,arguments)},style:{minWidth:150},onChange:function(e){return x(e)},value:y}),(0,Y.jsx)(Z.h,{placeholder:t("select.brand"),fetchOptions:function(e){return E.apply(this,arguments)},style:{minWidth:150},onChange:function(e){return o(e)},value:d})]}),children:[(0,Y.jsx)("div",{className:"d-flex justify-content-end mb-4",children:(0,Y.jsx)(ye.Z,{placeholder:t("search"),handleChange:S,defaultValue:null===N||void 0===N?void 0:N.search})}),(0,Y.jsxs)("div",{className:"products-row order-items",children:[A.length?A.map((function(e){var n,i,r,l;return(0,Y.jsxs)(f.Z,{className:"products-col",cover:(0,Y.jsx)("img",{alt:null===(n=e.product)||void 0===n||null===(i=n.translation)||void 0===i?void 0:i.title,src:(0,J.Z)(null===e||void 0===e?void 0:e.img)}),onClick:function(){return function(e){F.currency?F.address?F.deliveries?D(e):q.Am.warning(t("please.select.delivery")):q.Am.warning(t("please.select.address")):q.Am.warning(t("please.select.currency"))}(e)},children:[(0,Y.jsx)(W.Z,{title:null===e||void 0===e||null===(r=e.product)||void 0===r||null===(l=r.translation)||void 0===l?void 0:l.title}),(0,Y.jsx)("div",{className:"preview",children:(0,Y.jsx)(Q.Z,{})}),e.stocks.map((function(e){var n,t;return(0,Y.jsxs)("span",{className:e.bonus?"show-bonus":"d-none",children:[(0,Y.jsx)(he.ojn,{})," ",null===(n=e.bonus)||void 0===n?void 0:n.value,"+",null===(t=e.bonus)||void 0===t?void 0:t.bonus_quantity]})}))]},e.id)})):(0,Y.jsx)(s.Z,{children:(0,Y.jsx)(u.Z,{span:24,children:(0,Y.jsx)(Ze.Z,{id:"nosell"})})}),B&&(0,Y.jsx)("div",{className:"loader",children:(0,Y.jsx)(c.Z,{})})]}),M&&(0,Y.jsx)(ue,{extrasModal:M,setExtrasModal:D}),(0,Y.jsx)(me,{form:n})]})},ge=t(44653),_e=t(22054),be=t(1003);function ke(){var e=(0,_.$)().t,n=a.Z.useForm(),t=(0,r.Z)(n,1)[0],v=(0,j.I0)(),p=(0,w.UO)().id,f=(0,w.s0)(),h=(0,l.useState)(!1),m=(0,r.Z)(h,2),y=m[0],x=m[1],Z=(0,l.useState)(null),b=(0,r.Z)(Z,2),q=b[0],N=b[1],S=(0,l.useState)(!1),C=(0,r.Z)(S,2),I=C[0],M=C[1],D=(0,j.v9)((function(e){return e.order}),j.wU),U=D.data,H=D.total,O=D.coupon,A=D.orderProducts,E=D.orderItems,P=(0,j.v9)((function(e){return e.currency}),j.wU).currencies,$=(0,j.v9)((function(e){return e.menu}),j.wU).activeMenu;function z(e){return{label:e.firstname+" "+(e.lastname||""),value:e.id,uuid:e.uuid}}function L(e){var n;return e?{label:null===(n=e.translation)||void 0===n?void 0:n.title,value:e.id,open_time:e.open_time,close_time:e.close_time}:null}var W=function(e,n){var t={payment_sys_id:n.value};x(!0),R.Z.update(p,e).then((function(e){!function(e,n){be.Z.create(e,n).then((function(e){N(e.data.id),v((0,g.bn)())})).finally((function(){return x(!1)}))}(e.data.id,t)})).catch((function(){return x(!1)}))};return(0,l.useEffect)((function(){$.refetch&&(M(!0),R.Z.getById(p).then((function(e){var n,r,l,a,d=e.data;v((0,g.oM)({calculate:!0}));var o=d.details.map((function(e){var n;return(0,i.Z)((0,i.Z)({},e.stock.product),{},{stocks:e.stock.extras,stock:e.stock,stockID:e.stock,quantity:e.quantity,img:null===(n=e.stock.product)||void 0===n?void 0:n.img,price:e.stock.price,bonus:e.bonus,addons:e.addons})})),s={product_tax:null===d||void 0===d||null===(n=d.details)||void 0===n||null===(r=n.flatMap((function(e){return e.total_price})))||void 0===r?void 0:r.reduce((function(e,n){return e+n})),shop_tax:d.tax,order_total:d.total_price};v((0,g.r3)(o)),v((0,g.B4)(o)),v((0,g.rU)(s)),v((0,g.dY)(d.currency)),v((0,k.nc)({activeMenu:$,data:(0,i.Z)((0,i.Z)({},$.data),{},{addressData:{address:d.address.address,lat:d.location.latitude,lng:d.location.longitude}})})),v((0,g.oM)({userUuid:d.user.uuid,shop:L(d.shop),delivery_type:d.delivery_type,delivery_fee:d.delivery_fee,delivery_date:JSON.stringify(d.delivery_date),delivery_time:d.delivery_time,address:{address:d.address.address,lat:d.location.latitude,lng:d.location.longitude},currency:{id:d.currency.payment_system},payment_type:d.transaction,deliveries:{label:d.delivery_type}})),t.setFieldsValue({delivery_time:B()(null===d||void 0===d?void 0:d.delivery_time,"HH:mm:ss"),delivery_date:B()(d.delivery_date,"YYYY-MM-DD"),user:z(d.user),currency_id:d.currency.id,payment_type:{label:(null===(l=d.transaction)||void 0===l?void 0:l.payment_system.tag)||"cash",value:(null===(a=d.transaction)||void 0===a?void 0:a.payment_system.id)||1},note:d.note,delivery:{label:d.delivery_type,value:d.shop.price}})})).finally((function(){M(!1),v((0,k.A_)($))})))}),[$.refetch]),(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(d.Z,{title:e("edit.order"),extra:(0,Y.jsx)(o.Z,{type:"primary",loading:y,onClick:function(){return t.submit()},disabled:!(null!==A&&void 0!==A&&A.length),children:e("save")})}),(0,Y.jsxs)(a.Z,{name:"order-form",form:t,layout:"vertical",onFinish:function(e){var n,t,i,r,l,a=function(e){var n=null===e||void 0===e?void 0:e.map((function(e){var n,t;return{quantity:e.quantity,stock_id:e.stockID?null===(n=e.stockID)||void 0===n?void 0:n.id:null===(t=e.stock)||void 0===t?void 0:t.id}})),t=null===e||void 0===e?void 0:e.flatMap((function(e){var n;return null===(n=e.addons)||void 0===n?void 0:n.map((function(n,t){var i,r;return{quantity:n.quantity,stock_id:n.stock_id,parent_id:e.stockID?null===(i=e.stockID)||void 0===i?void 0:i.id:null===(r=e.stock)||void 0===r?void 0:r.id}}))}));return n.concat(t)}(E),d={currency_id:e.currency_id,rate:null===(n=P.find((function(n){return n.id===e.currency_id})))||void 0===n?void 0:n.rate,shop_id:U.shop.value,delivery_id:e.delivery.label,delivery_fee:U.delivery_fee,coupon:O.coupon,tax:H.order_tax,payment_type:null===(t=e.payment_type)||void 0===t?void 0:t.label,note:e.note,delivery_date:B()(e.delivery_date).format("YYYY-MM-DD"),address:{address:null===(i=$.data.addressData)||void 0===i?void 0:i.address,office:null,house:null,floor:null},location:{latitude:null===(r=$.data.addressData)||void 0===r?void 0:r.lat,longitude:null===(l=$.data.addressData)||void 0===l?void 0:l.lng},delivery_time:B()(U.delivery_time,"HH:mm").format("HH:mm"),delivery_type:U.delivery_type,products:a};W(d,e.payment_type)},className:"order-add",initialValues:{user:U.user||void 0,address:U.address||null,currency_id:U.currency.id,payment_type:U.payment_type||null},children:[(0,Y.jsxs)(s.Z,{gutter:24,hidden:I,children:[(0,Y.jsx)(u.Z,{span:16,children:(0,Y.jsx)(je,{form:t})}),(0,Y.jsxs)(u.Z,{span:8,children:[(0,Y.jsx)(F,{form:t}),(0,Y.jsx)(V,{form:t})]})]}),I&&(0,Y.jsx)("div",{className:"loader",children:(0,Y.jsx)(c.Z,{})})]}),q?(0,Y.jsx)(ge.Z,{orderId:q,handleClose:function(){N(null);var e="orders";v((0,k.ph)((0,i.Z)((0,i.Z)({},$),{},{nextUrl:e}))),f("/".concat(e)),v((0,_e.AU)())}}):""]})}}}]);